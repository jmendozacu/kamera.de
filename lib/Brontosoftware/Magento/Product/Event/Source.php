<?php
/**
 * This file was generated by the ConvertToLegacy class in bronto-legacy.
 * The purpose of the conversion was to maintain PSR-0 compliance while
 * the main development focuses on modern styles found in PSR-4.
 *
 * For the original:
 * @see src/Bronto/Magento/Product/Event/Source.php
 */

class Brontosoftware_Magento_Product_Event_Source implements Brontosoftware_Magento_Connector_Event_SourceInterface, Brontosoftware_Magento_Connector_Event_ContextProviderInterface
{
    protected $_helper;

    /**
     * @param Brontosoftware_Magento_Product_SettingsInterface $helper
     */
    public function __construct(
        Brontosoftware_Magento_Product_SettingsInterface $helper
    ) {
        $this->_helper = $helper;
    }

    /**
     * @see parent
     */
    public function create($product)
    {
        return array(
            'sku' => $product->getSku(),
            'scopes' => $product->hasScopes() ? $product->getScopes() : array(),
            'uniqueKey' => implode('.', array(
                $this->getEventType(),
                $this->action($product)[0],
                $product->getId(),
                $product->getStoreId()
            ))
        );
    }

    /**
     * @see parent
     */
    public function getEventType()
    {
        return 'product';
    }

    /**
     * @see parent
     */
    public function action($product)
    {
        return $product->getStatus() == 2 ? 'delete' : 'replace';
    }

    /**
     * @see parent
     */
    public function transform($product)
    {
        return array('fields' => $this->_helper->getFieldMapping($product));
    }
}
